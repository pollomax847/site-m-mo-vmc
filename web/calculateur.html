<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculateur de débits - Mémo Technique VMC</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .result-box { background: #f8f9fa; border-radius: 8px; padding: 1rem; margin-top: 1rem; }
    form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      align-items: center;
    }
    .form-section {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      width: 100%;
      justify-content: center;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      min-width: 220px;
      margin-bottom: 0.5rem;
    }
    .form-label {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .form-control {
      padding: 0.5rem 0.7rem;
      border-radius: 0.7rem;
      border: 1px solid #e5e7eb;
      font-size: 1.05rem;
      background: #fff;
      margin-bottom: 0.2rem;
    }
    @media (max-width: 700px) {
      .form-section {
        flex-direction: column;
        gap: 0.7rem;
      }
      .form-group {
        min-width: 0;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Calculateur de débits réglementaires</h1>
  </header>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="calculateur.html" class="active">Calculateur</a>
    <a href="simple-flux.html">Simple Flux</a>
    <a href="double-flux.html">Double Flux</a>
  </nav>
  <main>
    <div class="card" style="max-width:700px;width:100%;margin:2rem auto;">
      <form id="calcForm">
      <div class="form-section">
        <div class="form-group">
          <label for="vmcType" class="form-label">Type de VMC</label>
          <select class="form-control" id="vmcType" required>
            <option value="">Choisir...</option>
            <option value="simple-flux">Simple Flux</option>
            <option value="hygro-a">Hygro A</option>
            <option value="hygro-b">Hygro B</option>
          </select>
        </div>
        <div class="form-group">
          <label for="housingType" class="form-label">Type de logement</label>
          <select class="form-control" id="housingType" required>
            <option value="">Choisir...</option>
            <option value="T1">T1</option>
            <option value="T2">T2</option>
            <option value="T3">T3</option>
            <option value="T4">T4</option>
            <option value="T5+">T5+</option>
          </select>
          <div id="modulesResult" class="result-box d-none"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-group">
          <label for="cuisine" class="form-label">Nombre de cuisines</label>
          <input type="number" class="form-control" id="cuisine" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="sdb" class="form-label">Nombre de salles de bain</label>
          <input type="number" class="form-control" id="sdb" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="wc" class="form-label">Nombre de WC</label>
          <input type="number" class="form-control" id="wc" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="autreSdb" class="form-label">Autres salles d'eau</label>
          <input type="number" class="form-control" id="autreSdb" min="0" value="0">
        </div>
      </div>
      <div class="form-section">
        <div class="form-group">
          <label for="mesureCuisine" class="form-label">Débit mesuré cuisine (m³/h)</label>
          <input type="number" class="form-control" id="mesureCuisine" min="0" placeholder="Mesure cuisine">
        </div>
        <div class="form-group">
          <label for="mesureSdb" class="form-label">Débit mesuré salle de bain (m³/h)</label>
          <input type="number" class="form-control" id="mesureSdb" min="0" placeholder="Mesure salle de bain">
        </div>
        <div class="form-group">
          <label for="mesureWc" class="form-label">Débit mesuré WC (m³/h)</label>
          <input type="number" class="form-control" id="mesureWc" min="0" placeholder="Mesure WC">
        </div>
        <div class="form-group">
          <label for="mesureAutre" class="form-label">Débit mesuré autre salle d'eau (m³/h)</label>
          <input type="number" class="form-control" id="mesureAutre" min="0" placeholder="Mesure autre salle d'eau">
        </div>
      </div>
      <button type="submit" class="btn-main">Calculer</button>
    </form>
    <div id="results" class="result-box d-none"></div>
    <a href="index.html" class="btn-main mt-4">Retour à l'accueil</a>
  </main>
  <footer>
    <p>&copy; 2026 Mémo Technique VMC</p>
  </footer>
  <script>
    // --- LOGIQUE AMÉLIORÉE ET COMMENTÉE ---
    // Débits réglementaires par type de VMC et logement (valeurs réalistes)
    const debitsReglementaires = {
      'simple-flux': {
        'T1': { 'cuisine': 20, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T2': { 'cuisine': 30, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T3': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 15, 'autre-sdb': 15 },
        'T4': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 },
        'T5+': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 }
      },
      'hygro-a': {
        'T1': { 'cuisine': 20, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T2': { 'cuisine': 30, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T3': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 15, 'autre-sdb': 15 },
        'T4': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 },
        'T5+': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 }
      },
      'hygro-b': {
        'T1': { 'cuisine': 20, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T2': { 'cuisine': 30, 'salle-de-bain': 15, 'wc': 15, 'autre-sdb': 0 },
        'T3': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 15, 'autre-sdb': 15 },
        'T4': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 },
        'T5+': { 'cuisine': 45, 'salle-de-bain': 30, 'wc': 30, 'autre-sdb': 15 }
      }
    };
    // Débits minimaux réglementaires globaux
    const minimumDebitsParLogement = { 'T1': 100, 'T2': 150, 'T3': 200, 'T4': 250, 'T5+': 300 };
    // Remplissage automatique pour chaque type de logement
    const logementPresets = {
      'T1': { cuisine: 1, sdb: 1, wc: 0, autreSdb: 0, modules: ['1 cuisine', '1 salle de bain'] },
      'T2': { cuisine: 1, sdb: 1, wc: 1, autreSdb: 0, modules: ['1 cuisine', '1 salle de bain', '1 WC'] },
      'T3': { cuisine: 1, sdb: 1, wc: 1, autreSdb: 1, modules: ['1 cuisine', '1 salle de bain', '1 WC', '1 autre salle d\'eau'] },
      'T4': { cuisine: 1, sdb: 1, wc: 1, autreSdb: 1, modules: ['1 cuisine', '1 salle de bain', '1 WC', '1 autre salle d\'eau'] },
      'T5+': { cuisine: 1, sdb: 2, wc: 2, autreSdb: 1, modules: ['1 cuisine', '2 salles de bain', '2 WC', '1 autre salle d\'eau'] }
    };

    // Remplissage automatique des pièces selon le logement
    document.getElementById('housingType').addEventListener('change', function() {
      const val = this.value;
      if (logementPresets[val]) {
        document.getElementById('cuisine').value = logementPresets[val].cuisine;
        document.getElementById('sdb').value = logementPresets[val].sdb;
        document.getElementById('wc').value = logementPresets[val].wc;
        document.getElementById('autreSdb').value = logementPresets[val].autreSdb;
        // Affichage modules fenêtres
        const modulesDiv = document.getElementById('modulesResult');
        modulesDiv.innerHTML = `<h4>Modules fenêtres à prévoir</h4><ul>` + logementPresets[val].modules.map(m => `<li>${m}</li>`).join('') + `</ul>`;
        modulesDiv.classList.remove('d-none');
      } else {
        document.getElementById('modulesResult').classList.add('d-none');
      }
    });

    // Calcul principal
    document.getElementById('calcForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const vmcType = document.getElementById('vmcType').value;
      const housingType = document.getElementById('housingType').value;
      if (!vmcType || !housingType) return;
      const flows = debitsReglementaires[vmcType][housingType];
      // Récupère le nombre de pièces
      const cuisine = parseInt(document.getElementById('cuisine').value) || 0;
      const sdb = parseInt(document.getElementById('sdb').value) || 0;
      const wc = parseInt(document.getElementById('wc').value) || 0;
      const autreSdb = parseInt(document.getElementById('autreSdb').value) || 0;
      // Calcul théorique par pièce
      const results = {
        'Cuisine': cuisine * flows['cuisine'],
        'Salle de bain': sdb * flows['salle-de-bain'],
        'WC': wc * flows['wc'],
        'Autre salle d\'eau': autreSdb * flows['autre-sdb']
      };
      const total = Object.values(results).reduce((a, b) => a + b, 0);
      const minFlow = minimumDebitsParLogement[housingType];
      let html = `<h3>Résultats</h3><ul class='mb-3'>`;
      for (const [piece, val] of Object.entries(results)) {
        html += `<li><strong>${piece}</strong> : ${val} m³/h</li>`;
      }
      html += `</ul><p><strong>Débit total théorique</strong> : ${total} m³/h</p>`;
      html += `<p><strong>Débit minimal réglementaire</strong> : ${minFlow} m³/h</p>`;
      // Vérification des débits mesurés par bouche
      const mesureCuisine = parseInt(document.getElementById('mesureCuisine').value);
      const mesureSdb = parseInt(document.getElementById('mesureSdb').value);
      const mesureWc = parseInt(document.getElementById('mesureWc').value);
      const mesureAutre = parseInt(document.getElementById('mesureAutre').value);
      let mesures = [];
      if (!isNaN(mesureCuisine)) mesures.push({piece:'Cuisine', val:mesureCuisine, ref:flows['cuisine']});
      if (!isNaN(mesureSdb)) mesures.push({piece:'Salle de bain', val:mesureSdb, ref:flows['salle-de-bain']});
      if (!isNaN(mesureWc)) mesures.push({piece:'WC', val:mesureWc, ref:flows['wc']});
      if (!isNaN(mesureAutre)) mesures.push({piece:"Autre salle d'eau", val:mesureAutre, ref:flows['autre-sdb']});
      if (mesures.length > 0) {
        html += `<h4>Vérification des mesures réelles</h4><ul>`;
        let totalMesure = 0;
        let conforme = true;
        for (const m of mesures) {
          totalMesure += m.val;
          const ok = m.val >= m.ref;
          if (!ok) conforme = false;
          html += `<li>${m.piece} : ${m.val} m³/h (attendu ≥ ${m.ref}) <span style='color:${ok?'#16a34a':'#dc2626'}'>${ok?'✔️':'❌'}</span></li>`;
        }
        html += `</ul><p><strong>Total mesuré</strong> : ${totalMesure} m³/h</p>`;
        html += `<p><strong>Débit minimal réglementaire</strong> : ${minFlow} m³/h</p>`;
        html += `<p class='${(totalMesure >= minFlow && conforme) ? 'text-success' : 'text-danger'}'><strong>${(totalMesure >= minFlow && conforme) ? 'Conforme' : 'Non conforme'}</strong> (mesures réelles)</p>`;
      } else {
        html += `<p class='${total >= minFlow ? 'text-success' : 'text-danger'}'><strong>${total >= minFlow ? 'Conforme' : 'Non conforme'}</strong> (calcul théorique)</p>`;
      }
      const resDiv = document.getElementById('results');
      resDiv.innerHTML = html;
      resDiv.classList.remove('d-none');
    });
  </script>
</body>
</html>
